{"version":3,"sources":["webpack:///src/app/videocall/videocall.page.ts","webpack:///src/app/videocall/videocall.module.ts","webpack:///src/app/videocall/videocall-routing.module.ts","webpack:///src/app/videocall/videocall.page.html","webpack:///src/app/providers/webrtc.service.ts","webpack:///src/app/videocall/videocall.page.scss"],"names":["VideocallPage","webRTC","elRef","storage","http","media","navCtrl","route","topVideoFrame","outgng","pvideo","ring","create","ringtone","busytone","get","then","udetails","userDetails","userId","mobile","init","partner","partnerId","StartVCall","vidcall","setTimeout","call","ObservableVar","interval","subscribe","CheckCallStatus","CheckIncomming","ApiUrl","callId","Cstat","console","log","Status","status","Ans_Status","ans_status","setVolume","callend","user_mobile","incval","incomming","caller_mobile","id","play","calheader","MianDiv","AudioDiv","incmng","pid","ResponseData","calval","callstatus","ringer","setInterval","clearInterval","callEnd","myEl","nativeElement","querySelector","muted","partnerEl","swapVideo","topVideo","close","Endcall","unsubscribe","navigate","mycall","selector","template","VideocallPageModule","imports","declarations","routes","path","component","VideocallPageRoutingModule","forChild","exports","WebrtcService","stun","stunServer","urls","options","key","debug","navigator","mediaDevices","getUserMedia","audio","video","stream","handleSuccess","nowstream","getMedia","e","handleError","createPeer","setupPAudioOutput","peer","on","wait","myStream","srcObject","answer","tracks","getTracks","forEach","track","stop","destroy","error","name","errorMsg","msg","errorElement","document","innerHTML","paudio","enumerateDevices","devices","audioDevices","filter","device","kind","setSinkId","deviceId","providedIn"],"mappings":"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","file":"videocall-videocall-module-es5.js","sourcesContent":["import { HttpClient } from '@angular/common/http';\nimport { Component, ElementRef} from '@angular/core';\nimport { Router } from '@angular/router';\nimport { Media } from '@ionic-native/media/ngx';\nimport { NavController } from '@ionic/angular';\nimport { Storage } from '@ionic/storage-angular';\nimport { AppComponent } from '../app.component';\nimport { WebrtcService } from '../providers/webrtc.service';\nimport { Observable } from \"rxjs/rx\";\nimport { Subscription } from 'rxjs/Subscription';\n@Component({\n  selector: 'app-videocall',\n  templateUrl: './videocall.page.html',\n  styleUrls: ['./videocall.page.scss'],\n})\nexport class VideocallPage  {\n  topVideoFrame = 'partner-video';\n  userId: string;\n  partnerId: string;\n  myEl: HTMLMediaElement;\n  partnerEl: HTMLMediaElement;\n  userDetails: any;\n  ring: any;\n  ringtone: any;\n  busytone: any;\n  ResponseData: Object;\n  callId: any;\n  callstatus: Object;\n  user_mobile: string;\n  incomming: Object;\n  calheader: boolean;\n  MianDiv: boolean;\n  AudioDiv: boolean;\n  incmng: boolean;\n  outgng: any=false;\n  Endcall: Object;\n  ObservableVar: Subscription;\n  Cstat: Object;\n  Status: any;\n  Ans_Status: any;\n  callrecord: any;\n  callduration: any;\n  mymeType: any;\n  pvideo:any=false;\n  ans_status: Object;\n  constructor(\n    public webRTC: WebrtcService,\n    public elRef: ElementRef,\n    private storage  :Storage,\n    private http: HttpClient,\n    private media : Media,\n    public navCtrl: NavController,\n    private route : Router\n  ) { \n    this.ring = this.media.create('assets/ringtones/ring.mp3');\n    this.ringtone = this.media.create('assets/ringtones/ringtone.mp3');\n    this.busytone = this.media.create('assets/ringtones/busy.mp3')\n  }\n\n  ngOnInit() {\n    this.storage.get('userdetails').then((udetails)=>{\n      this.userDetails = udetails;\n      this.userId = this.userDetails[0].mobile;\n      this.init();\n    });\n\n    this.storage.get(\"partnerId\").then(partner=>{\n      this.partnerId = partner;\n      this.StartVCall(this.partnerId);\n      let vidcall = this;\n      setTimeout(function(){\n        vidcall.call();\n      }, 3000);\n    })\n\n    this.ObservableVar = Observable.interval(2000).subscribe(()=>{ \n      this.CheckCallStatus();\n      this.CheckIncomming();\n    });\n  }\n\n  CheckCallStatus(){\n    this.http.get(AppComponent.ApiUrl+\"checkcallstatus.php?call_id=\"+this.callId).subscribe((Cstat)=>{\n      this.Cstat=Cstat;\n      console.log(\"Call Status is:\", this.Cstat);\n      if(this.Cstat !=0){\n        this.Status = this.Cstat[0].status;\n        this.Ans_Status = this.Cstat[0].ans_status;\n        if(this.Ans_Status==1){\n          this.ring.setVolume(0);\n          this.pvideo=true;\n        }\n        if(this.Status==2){\n          this.callend();\n        }\n      }\n    \n\n    });\n   \n  } \n\n  CheckIncomming(){\n    this.http.get(AppComponent.ApiUrl+\"checkincomming.php?user_mobile=\"+this.user_mobile).subscribe((incval)=>{\n      this.incomming = incval;\n      console.log(\"calls Pge Inoming Staus\", this.incomming)\n      if(this.incomming !=0){\n        this.partnerId=this.incomming[0].caller_mobile;\n        this.callId = this.incomming[0].id;\n      console.log(\"Incoming call details are:\",this.incomming);\n      this.ringtone.setVolume(1);\n      this.ringtone.play();\n      this.calheader=false;\n            this.MianDiv=false;\n            this.AudioDiv=true;\n            this.incmng=true;\n            this.outgng = false;\n      }\n      \n    });\n  }\n\n      //start Call\n      StartVCall(pid){\n        this.http.get(AppComponent.ApiUrl+\"startcall.php?user_mobile=\"+this.userId+\"&calee_mobile=\"+pid+\"&call_type=video\").subscribe((ResponseData)=>{\n          this.ResponseData =ResponseData\n          console.log(\"Call Response Data:\", this.ResponseData)\n          if(this.ResponseData!=0){\n           this.callId = this.ResponseData;\n           this.http.get(AppComponent.ApiUrl+\"callstatus.php?calee_moble=\"+pid).subscribe((calval)=>{\n             this.callstatus = calval;\n             if(this.callstatus==0){\n              this.ring = this.media.create('https://topiko.com/ringtones/ring.mp3');\n              console.log(this.ring);\n              this.ring.setVolume(1);\n              this.ring.play();\n              let ringer = this\n              setInterval(function(){\n                ringer.ring.play();\n              },2000);\n              setTimeout(() => {\n                clearInterval();\n              }, 10000);\n              setTimeout(()=>{\n                ringer.callend();\n              }, 45000);\n              \n             }\n             else{\n              this.busytone = this.media.create('https://topiko.com/ringtones/busy.mp3')\n               this.busytone.setVolume(1);\n               this.busytone.play();\n               let callEnd =this;\n               setTimeout(function(){\n                callEnd.callend();\n               },8000);\n             }\n           })\n          }\n        })\n        }\n  \n\n      // Strat call code EndsHere\n\n  async init() {\n    this.myEl = this.elRef.nativeElement.querySelector('#my-video');\n    this.myEl.muted=true;\n    this.partnerEl = this.elRef.nativeElement.querySelector('#partner-video');\n    this.webRTC.init(this.userId, this.myEl, this.partnerEl);\n  }\n\n  async call() {\n    this.webRTC.call(this.partnerId);\n    this.swapVideo('my-video');\n  }\n\n  swapVideo(topVideo: string) {\n    this.topVideoFrame = topVideo;\n  }\n  callend(){\n    this.calheader=true;\n    this.AudioDiv=false;\n    this.MianDiv=true;\n    this.ring.setVolume(0);\n    this.ringtone.setVolume(0);\n    this.busytone.setVolume(0);\n    this.webRTC.close();\n    this.http.get(AppComponent.ApiUrl+\"endcall.php?call_id=\"+this.callId+\"&record=none\").subscribe((Endcall)=>{\n      this.Endcall = Endcall;\n      if(this.Endcall==1){\n        this.ObservableVar.unsubscribe;\n        this.route.navigate(['/home']);\n      }\n    }) \n  }\n\n  AnsCall(){\n    console.log(\"Call_id\", this.incomming[0].id);\n    this.ringtone.setVolume(0);\n    this.incmng=false;\n    this.outgng = true;\n    this.http.get(AppComponent.ApiUrl+\"answerstatus.php?call_id=\"+this.incomming[0].id).subscribe((ans_status)=>{\n      this.ans_status = ans_status;\n      if(this.ans_status==1){\n        console.log(\"Call answered\");\n        this.partnerId = this.incomming[0].caller_mobile; \n        this.calheader=false;\n        this.MianDiv=false;\n        this.AudioDiv=true;\n        this.myEl = this.elRef.nativeElement.querySelector('#my-video');\n        this.myEl.muted=true;\n        this.partnerEl = this.elRef.nativeElement.querySelector('#partner-video');\n        this.webRTC.init(this.user_mobile, this.myEl, this.partnerEl);\n        let mycall = this;\n        setTimeout(function(){ \n          mycall.call();\n        },5000)\n    \n      }\n    });\n\n    } \n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { VideocallPageRoutingModule } from './videocall-routing.module';\n\nimport { VideocallPage } from './videocall.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    VideocallPageRoutingModule\n  ],\n  declarations: [VideocallPage]\n})\nexport class VideocallPageModule {}\n","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { VideocallPage } from './videocall.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: VideocallPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class VideocallPageRoutingModule {}\n","export default \"<ion-content>\\n  <div id=\\\"errorMsg\\\"></div>\\n\\n  <video id=\\\"partner-video\\\" *ngIf=\\\"pvideo\\\" (click)=\\\"swapVideo('my-video')\\\" autoplay playsinline\\n    [ngClass]=\\\"{'top-video': topVideoFrame === 'partner-video', 'main-video': topVideoFrame != 'partner-video'}\\\">\\n  </video>\\n  <video id=\\\"my-video\\\" (click)=\\\"swapVideo('partner-video')\\\" autoplay playsinline\\n    [ngClass]=\\\"{'top-video': topVideoFrame === 'my-video', 'main-video': topVideoFrame != 'my-video'}\\\" >\\n  </video>\\n\\n\\n  <!-- <ion-row nowrap style=\\\"display: none;\\\">\\n    <ion-button (click)=\\\"init()\\\">Login As: </ion-button>\\n    <ion-item>\\n      <ion-input type=\\\"text\\\" [(ngModel)]=\\\"userId\\\" placeholder=\\\"enter your nick name\\\"></ion-input>\\n    </ion-item>\\n  </ion-row>\\n\\n  <ion-row nowrap style=\\\"display: none;\\\">\\n    <ion-button (click)=\\\"call()\\\">Call To: </ion-button>\\n    <ion-item>\\n      <ion-input type=\\\"text\\\" [(ngModel)]=\\\"partnerId\\\" placeholder=\\\"your partner nick name\\\"></ion-input>\\n    </ion-item>\\n  </ion-row>   -->\\n</ion-content>\\n\\n<ion-footer>\\n  <ion-row>\\n    <ion-col>\\n      <ion-fab-button class=\\\"acc-call\\\" *ngIf=\\\"incmng\\\">\\n        <ion-icon name=\\\"call-outline\\\"></ion-icon>\\n      </ion-fab-button>\\n\\n      <ion-fab-button color=\\\"light\\\">\\n      <ion-icon name=\\\"mic-outline\\\" *ngIf=\\\"outgng\\\"  style=\\\"color: #000;\\\"></ion-icon>\\n      <ion-icon name=\\\"mic-off-outline\\\"  style=\\\"color: #000;\\\"></ion-icon>\\n    </ion-fab-button>\\n    </ion-col>\\n    <ion-col>\\n      <ion-icon name=\\\"camera-reverse-outline\\\"></ion-icon>\\n    </ion-col>\\n    <ion-col>\\n      <ion-fab-button (click)=\\\"callend()\\\">\\n        <ion-icon name=\\\"call-outline\\\" style=\\\"transform: rotate(135deg);\\\"></ion-icon>\\n      </ion-fab-button>\\n      \\n    </ion-col>\\n  </ion-row>\\n</ion-footer>\";","import { Injectable } from '@angular/core';\nimport Peer from 'peerjs';\n@Injectable({\n  providedIn: 'root'\n})\nexport class WebrtcService {\n  peer: Peer;\n  myStream: MediaStream;\n  myEl: HTMLMediaElement;\n  partnerEl: HTMLMediaElement;\n\n  stun = 'stun.l.google.com:19302';\n  mediaConnection: Peer.MediaConnection;\n  options: Peer.PeerJSOption;\n  stunServer: RTCIceServer = {\n    urls: 'stun:' + this.stun,\n  };\n  nowstream: MediaStream;\n  constructor() {\n    this.options = {  // not used, by default it'll use peerjs server\n      key: 'cd1ft79ro8g833di',\n      debug: 3\n    };\n    \n   }\n   getMedia() {\n     navigator.mediaDevices.getUserMedia({ audio: true, video: true}).then((stream)=>{\n      this.handleSuccess(stream);\n      this.nowstream = stream;\n     })\n   /* navigator.getUserMedia({ audio: true}, (stream) => {\n    this.handleSuccess(stream);\n      this.nowstream = stream;\n    }, (error) => {\n      this.handleError(error);\n    }); */\n  }\n\n  async init(userId: string, myEl: HTMLMediaElement, partnerEl: HTMLMediaElement) {\n    this.myEl = myEl;\n    this.partnerEl = partnerEl;\n    try {\n      this.getMedia();\n    } catch (e) {\n      this.handleError(e);\n    }\n    await this.createPeer(userId);\n    this.setupPAudioOutput(this.partnerEl);\n  }\n\n  async createPeer(userId: string) {\n    this.peer = new Peer(userId);\n    this.peer.on('open', () => {\n      this.wait();\n    });\n  }\n\n  call(partnerId: string) {\n    const call = this.peer.call(partnerId, this.myStream);\n    call.on('stream', (stream) => {\n      console.log(stream);\n      this.partnerEl.srcObject = stream;\n    });\n  }\n\n  wait() {\n    this.peer.on('call', (call) => {\n      call.answer(this.myStream);\n      call.on('stream', (stream) => {\n        this.partnerEl.srcObject = stream;\n      });\n    });\n  }\n\n  handleSuccess(stream: MediaStream) {\n    this.myStream = stream;\n    this.myEl.srcObject = stream;\n  }\n  close() {\n    const stream = this.nowstream;\n  const tracks = stream.getTracks();\n\n  tracks.forEach(function(track) {\n    track.stop();\n  });\n   this.peer.destroy();\n  }\n  handleError(error: any) {\n    if (error.name === 'ConstraintNotSatisfiedError') {\n      //const v = constraints.video;\n     // this.errorMsg(`The resolution ${v.width.exact}x${v.height.exact} px is not supported by your device.`);\n      this.errorMsg(`The resolution px is not supported by your device.`);\n    } else if (error.name === 'PermissionDeniedError') {\n      this.errorMsg('Permissions have not been granted to use your camera and ' +\n        'microphone, you need to allow the page access to your devices in ' +\n        'order for the demo to work.');\n    }\n    this.errorMsg(`getUserMedia error: ${error.name}`, error);\n  }\n\n  errorMsg(msg: string, error?: any) {\n    const errorElement = document.querySelector('#errorMsg');\n    errorElement.innerHTML += `<p>${msg}</p>`;\n    if (typeof error !== 'undefined') {\n      console.error(error);\n    }\n  }\n  async setupPAudioOutput(paudio){\n    const devices = await navigator.mediaDevices.enumerateDevices();\n    console.log(devices);\nconst audioDevices = devices.filter(device => device.kind === 'audiooutput');\n\nawait paudio.setSinkId(audioDevices[1].deviceId);\n\n  }\n}\n","export default \"ion-footer ion-icon {\\n  width: 32px;\\n  height: 32px;\\n}\\n\\nion-fab-button {\\n  --background: red !important;\\n  width: 50px;\\n  height: 50px;\\n}\\n\\n.acc-call {\\n  --background: green !important;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uXFwuLlxcLi5cXHZpZGVvY2FsbC5wYWdlLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFFSSxXQUFBO0VBQ0EsWUFBQTtBQUFKOztBQUlBO0VBRUksNEJBQUE7RUFDQSxXQUFBO0VBQ0EsWUFBQTtBQUZKOztBQUlBO0VBRUksOEJBQUE7QUFGSiIsImZpbGUiOiJ2aWRlb2NhbGwucGFnZS5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiaW9uLWZvb3RlciBpb24taWNvblxyXG57XHJcbiAgICB3aWR0aDogMzJweDtcclxuICAgIGhlaWdodDogMzJweDtcclxuXHJcbn1cclxuXHJcbmlvbi1mYWItYnV0dG9uXHJcbntcclxuICAgIC0tYmFja2dyb3VuZDogcmVkICFpbXBvcnRhbnQ7XHJcbiAgICB3aWR0aDogNTBweDtcclxuICAgIGhlaWdodDogNTBweDtcclxufVxyXG4uYWNjLWNhbGxcclxue1xyXG4gICAgLS1iYWNrZ3JvdW5kOiBncmVlbiAhaW1wb3J0YW50O1xyXG59Il19 */\";"]}